<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="pms.dao.WorkPageDao">
	<select id="getWorkPageList" resultType="workpage" parameterType="int">
		SELECT g.name,g.progress,g.jmstatus,h.jname,h.jstart,h.jend,g.pname,h.content,h.juptdate
		FROM
		(SELECT e.name,f.jid,f.progress,f.jmstatus,e.pname
		FROM 
		(SELECT c.name,c.pid,c.ppid,d.pid,d.pname,c.mid
		FROM 
		(SELECT a.name,b.ppid,b.pid,a.mid
		FROM MEMBER a, participants b
		WHERE a.mid=b.mid
		AND a.mid=#{mid}) c, project d
		WHERE c.pid=d.pid
		AND c.pid=#{pid}) e,jobmember f
		WHERE e.ppid=f.ppid) g,jobplan h
		WHERE g.jid=h.jid
	</select>

	<insert id="insertFile" parameterType="workpagefile">
		insert into jobfile values(jobfile_seq.nextval,
									#{jmid},
									sysdate,
									#{path},
									#{fname} )
	</insert>
	
	<select id="getWokrPageDetail" resultType="int" parameterType="workpage" >
		SELECT g.name,g.progress,g.jmstatus,h.jname,h.jstart,h.jend,g.pname,h.content,h.juptdate
		FROM
		(SELECT e.name,f.jid,f.progress,f.jmstatus,e.pname
		FROM 
		(SELECT c.name,c.pid,c.ppid,d.pid,d.pname
		FROM 
		(SELECT a.name,b.ppid,b.pid,a.mid
		FROM MEMBER a, participants b
		WHERE a.mid=b.mid
		AND a.mid=#{mid}) c, project d
		WHERE c.pid=d.pid) e,jobmember f
		WHERE e.ppid=f.ppid) g,jobplan h
		WHERE g.jid=h.jid
	</select>
	<select id="WorkPageList" resultType="workpage">
		SELECT g.name,g.progress,g.jmstatus,h.jname,h.jstart,h.jend,g.pname,h.content,h.juptdate,g.mid
		FROM
		(SELECT e.name,f.jid,f.progress,f.jmstatus,e.pname,e.mid
		FROM 
		(SELECT c.name,c.pid,c.ppid,d.pid,d.pname,c.mid
		FROM 
		(SELECT a.name,b.ppid,b.pid,a.mid
		FROM MEMBER a, participants b
		WHERE a.mid=b.mid
		AND a.mid=b.mid) c, project d
		WHERE c.pid=d.pid) e,jobmember f
		WHERE e.ppid=f.ppid) g,jobplan h
		WHERE g.jid=h.jid
	</select>
<!-- 		
		SELECT j.*, f.* 
		FROM jobplan j, jobfile f
		WHERE j.pid =f.fid
		and j.pid = #{pid}
-->
	
	
</mapper>
        
        